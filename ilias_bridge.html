<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lernmodul - Pohlscher Resonator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        
        #loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: white;
        }
        
        .spinner {
            border: 4px solid rgba(0, 95, 155, 0.1);
            border-left-color: rgb(0, 95, 155);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        #info {
            margin-top: 20px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
            max-width: 600px;
            text-align: center;
        }
        
        #info h2 {
            color: rgb(21, 50, 104);
            margin-bottom: 10px;
        }
        
        #info p {
            color: rgb(59, 59, 58);
            line-height: 1.6;
        }
        
        #info code {
            background: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: rgb(0, 95, 155);
        }
        
        iframe {
            width: 100%;
            height: 100vh;
            border: none;
            display: none;
        }
        
        iframe.loaded {
            display: block;
        }
        
        #error {
            display: none;
            padding: 40px;
            text-align: center;
            color: #c62828;
        }
        
        #error.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div id="loading">
        <div class="spinner"></div>
        <div id="info">
            <h2>Lernmodul wird geladen...</h2>
            <p id="session-info">Session ID wird gelesen...</p>
        </div>
    </div>
    
    <!-- Error screen -->
    <div id="error">
        <h2>⚠️ Keine aktive Session</h2>
        <p>Bitte melden Sie sich im Framework an, um auf das Lernmodul zuzugreifen.</p>
    </div>
    
    <!-- The actual learning module iframe -->
    <iframe id="learning-module" title="Pohlscher Resonator Lernmodul"></iframe>

    <script>
        // Configuration
        const LEARNING_MODULE_URL = 'https://wwwuser.gwdguser.de/physik.didaktik/oer/pohl/';
        const SHOW_DEBUG_INFO = true; // Set to false in production
        
        // Get PHPSESSID cookie
        function getCookie(name) {
            const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
            return match ? match[2] : null;
        }
        
        // Get all cookies for debugging
        function getAllCookies() {
            const cookies = {};
            document.cookie.split(';').forEach(cookie => {
                const [name, value] = cookie.trim().split('=');
                cookies[name] = value;
            });
            return cookies;
        }
        
        // Initialize
        function init() {
            const sessionId = getCookie('PHPSESSID');
            const infoElement = document.getElementById('session-info');
            
            if (SHOW_DEBUG_INFO) {
                console.log('=== SESSION DEBUG INFO ===');
                console.log('PHPSESSID:', sessionId);
                console.log('All cookies:', getAllCookies());
                console.log('Current URL:', window.location.href);
                console.log('========================');
            }
            
            if (sessionId) {
                // Display session info
                infoElement.innerHTML = `
                    <p>Session gefunden!</p>
                    ${SHOW_DEBUG_INFO ? '<p>Session ID: <code>' + sessionId + '</code></p>' : ''}
                `;
                
                // Build URL with session ID as query parameter
                const moduleUrl = `${LEARNING_MODULE_URL}?session_id=${encodeURIComponent(sessionId)}`;
                
                if (SHOW_DEBUG_INFO) {
                    console.log('Loading module URL:', moduleUrl);
                }
                
                // Load the learning module in iframe
                const iframe = document.getElementById('learning-module');
                iframe.src = moduleUrl;
                
                // Hide loading screen once iframe loads
                iframe.onload = function() {
                    document.getElementById('loading').style.display = 'none';
                    iframe.classList.add('loaded');
                    
                    if (SHOW_DEBUG_INFO) {
                        console.log('Learning module loaded successfully');
                    }
                };
                
                // Handle iframe load errors
                iframe.onerror = function() {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').classList.add('show');
                    document.getElementById('error').innerHTML = `
                        <h2>⚠️ Fehler beim Laden</h2>
                        <p>Das Lernmodul konnte nicht geladen werden.</p>
                        ${SHOW_DEBUG_INFO ? '<p>Überprüfen Sie die Konsole für Details.</p>' : ''}
                    `;
                };
                
            } else {
                // No session found
                console.error('No PHPSESSID cookie found');
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').classList.add('show');
                
                if (SHOW_DEBUG_INFO) {
                    document.getElementById('error').innerHTML += `
                        <p style="margin-top: 20px; font-size: 0.9em; color: #666;">
                            Debug: Keine Session-Cookie gefunden.<br>
                            Verfügbare Cookies: <code>${Object.keys(getAllCookies()).join(', ')}</code>
                        </p>
                    `;
                }
            }
        }
        
        // Run on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>